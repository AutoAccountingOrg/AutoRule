import {DataType} from "../utils/DataType";
import path from "path";
import fs from "fs";

const {execSync} = require('child_process');

execSync('yarn dev', {stdio: 'inherit'});

const dataFilePath = path.join(__dirname, "..", "..", 'dist', 'rule.js');
// 使用readFileSync来同步读取文件内容
const data = fs.readFileSync(dataFilePath, 'utf8')

//这是模拟java调用方法，完整构建数据
test("App规则调用校验", () => {
    var window = {
        data: `[{"mk":240358230526200007,"st":1,"isSc":0,"appId":"","mct":1710774326000,"pl":"{\\"templateType\\":\\"BN\\",\\"commandType\\":\\"UPDATE\\",\\"withPushNfc\\":\\"Y\\",\\"expireLink\\":\\"\\",\\"msgType\\":\\"TODO\\",\\"icon\\":\\"https:\\/\\/gw.alipayobjects.com\\/mdn\\/rms_f96971\\/afts\\/img\\/A*leNcS41oUu0AAAAAAAAAAABkARQnAQ\\",\\"link\\":\\"alipays:\\/\\/platformapi\\/startapp?appId=20000003&actionType=toBillDetails&tradeNO=20240318200040031100470038298342&bizType=B_TRANSFER?tagid=MB_SEND_PUSH_WALLET_NEW\\",\\"businessId\\":\\"PAY_HELPER_CARD_2088902213112478\\",\\"msgId\\":\\"415558d70962dbe2501b9a55653738c800247\\",\\"templateCode\\":\\"00059_00094_zfzs001\\",\\"templateId\\":\\"WALLET-BILL@BLPaymentHelper\\",\\"title\\":\\"付款成功\\",\\"content\\":\\"{\\\\\\"status\\\\\\":\\\\\\"付款成功\\\\\\",\\\\\\"date\\\\\\":\\\\\\"03月18日\\\\\\",\\\\\\"amountTip\\\\\\":\\\\\\"\\\\\\",\\\\\\"money\\\\\\":\\\\\\"1.00\\\\\\",\\\\\\"unit\\\\\\":\\\\\\"元\\\\\\",\\\\\\"infoTip\\\\\\":\\\\\\"\\\\\\",\\\\\\"failTip\\\\\\":\\\\\\"\\\\\\",\\\\\\"goto\\\\\\":\\\\\\"alipays:\\/\\/platformapi\\/startapp?appId=20000003&actionType=toBillDetails&tradeNO=20240318200040031100470038298342&bizType=B_TRANSFER\\\\\\",\\\\\\"content\\\\\\":[{\\\\\\"title\\\\\\":\\\\\\"付款方式：\\\\\\",\\\\\\"content\\\\\\":\\\\\\"农业银行储蓄卡(9979)\\\\\\"},{\\\\\\"title\\\\\\":\\\\\\"交易对象：\\\\\\",\\\\\\"content\\\\\\":\\\\\\"支付宝红包\\\\\\"}],\\\\\\"ad\\\\\\":[],\\\\\\"actions\\\\\\":[{\\\\\\"name\\\\\\":\\\\\\"\\\\\\",\\\\\\"url\\\\\\":\\\\\\"\\\\\\"},{\\\\\\"name\\\\\\":\\\\\\"查看详情\\\\\\",\\\\\\"url\\\\\\":\\\\\\"alipays:\\/\\/platformapi\\/startapp?appId=20000003&actionType=toBillDetails&tradeNO=20240318200040031100470038298342&bizType=B_TRANSFER\\\\\\"}]}\\",\\"linkName\\":\\"\\",\\"bizName\\":\\"支付助手\\",\\"msgCategory\\":\\"bill\\",\\"scm\\":\\"27.gotone.card.415558d70962dbe2501b9a55653738c800247.MB_SEND_PUSH_WALLET_NEW.null.payment_assist.43545.11069.2019062521000502094325.990\\",\\"assistInfo\\":\\"{\\\\\\"showInFriendTab\\\\\\":false,\\\\\\"icon\\\\\\":\\\\\\"https:\\/\\/gw.alipayobjects.com\\/mdn\\/rms_f96971\\/afts\\/img\\/A*ZapXT6AjvG0AAAAAAAAAAABkARQnAQ\\\\\\",\\\\\\"reminderType\\\\\\":\\\\\\"point\\\\\\",\\\\\\"hiddenMsgHeader\\\\\\":false,\\\\\\"title\\\\\\":\\\\\\"支付助手\\\\\\",\\\\\\"reminderTypeModifyEnable\\\\\\":false,\\\\\\"assistId\\\\\\":\\\\\\"payment_assist\\\\\\",\\\\\\"desc\\\\\\":\\\\\\"支付宝资金变动通知\\\\\\"}\\",\\"ih\\":\\"{\\\\\\"extInfo\\\\\\":{},\\\\\\"iid\\\\\\":\\\\\\"105\\\\\\",\\\\\\"ioty\\\\\\":\\\\\\"aor\\\\\\",\\\\\\"itemBasicInfo\\\\\\":{\\\\\\"dn\\\\\\":\\\\\\"服务提醒\\\\\\",\\\\\\"ic\\\\\\":\\\\\\"https:\\/\\/gw.alipayobjects.com\\/zos\\/bmw-prod\\/b96c31e0-64ba-4cbb-9a64-73ff17d701fd.webp\\\\\\",\\\\\\"lk\\\\\\":\\\\\\"alipays:\\/\\/platformapi\\/startapp?appId=20000235&source=friendTab\\\\\\"},\\\\\\"itemUserRelation\\\\\\":{\\\\\\"ilf\\\\\\":\\\\\\"N\\\\\\",\\\\\\"uc\\\\\\":{\\\\\\"top\\\\\\":\\\\\\"0\\\\\\"},\\\\\\"version\\\\\\":0},\\\\\\"ity\\\\\\":\\\\\\"105\\\\\\",\\\\\\"moty\\\\\\":\\\\\\"u\\\\\\",\\\\\\"msgInfo\\\\\\":{\\\\\\"bm\\\\\\":\\\\\\"付款成功￥1.00 \\\\\\",\\\\\\"cmid\\\\\\":\\\\\\"415558d70962dbe2501b9a55653738c800247\\\\\\",\\\\\\"lmt\\\\\\":1710774326186,\\\\\\"msrid\\\\\\":\\\\\\"00059_00094_zfzs001\\\\\\",\\\\\\"ncs\\\\\\":\\\\\\"N\\\\\\",\\\\\\"rps\\\\\\":\\\\\\"num\\\\\\",\\\\\\"sam\\\\\\":\\\\\\"Y\\\\\\",\\\\\\"ssrid\\\\\\":\\\\\\"PAY_HELPER_CARD_2088902213112478\\\\\\",\\\\\\"urn\\\\\\":1}}\\",\\"bizMonitor\\":\\"{\\\\\\"serviceCode\\\\\\":\\\\\\"MB_SEND_PUSH_WALLET_NEW\\\\\\",\\\\\\"bizName\\\\\\":\\\\\\"\\\\\\",\\\\\\"createTime\\\\\\":1710774326378,\\\\\\"businessId\\\\\\":\\\\\\"PAY_HELPER_CARD_2088902213112478\\\\\\",\\\\\\"messageId\\\\\\":\\\\\\"415558d70962dbe2501b9a55653738c800247\\\\\\",\\\\\\"messageTitle\\\\\\":\\\\\\"付款成功\\\\\\",\\\\\\"pid\\\\\\":\\\\\\"2088723328673582\\\\\\",\\\\\\"templateId\\\\\\":\\\\\\"WALLET-BILL@BLPaymentHelper\\\\\\",\\\\\\"status\\\\\\":\\\\\\"\\\\\\"}\\",\\"languageType\\":\\"zh-Hans\\",\\"subscribeConfig\\":\\"0\\",\\"gmtCreate\\":1710774326186,\\"gmtValid\\":1713366326176,\\"operate\\":\\"SEND\\",\\"templateName\\":\\"支付助手\\",\\"homePageTitle\\":\\"付款成功￥1.00 \\",\\"status\\":\\"\\",\\"extraInfo\\":\\"{\\\\\\"topSubContent\\\\\\":\\\\\\"付款成功\\\\\\",\\\\\\"preValue\\\\\\":\\\\\\"￥\\\\\\",\\\\\\"languageType\\\\\\":\\\\\\"zh-Hans\\\\\\",\\\\\\"isPaymentMsg\\\\\\":true,\\\\\\"assistName2\\\\\\":\\\\\\"交易对象\\\\\\",\\\\\\"assistName3\\\\\\":\\\\\\"\\\\\\",\\\\\\"assistName1\\\\\\":\\\\\\"付款方式\\\\\\",\\\\\\"templateId\\\\\\":\\\\\\"WALLET-FWC@remindNumber\\\\\\",\\\\\\"content\\\\\\":\\\\\\"1.00\\\\\\",\\\\\\"linkName\\\\\\":\\\\\\"\\\\\\",\\\\\\"assistMsg3\\\\\\":\\\\\\"\\\\\\",\\\\\\"sceneExt2\\\\\\":{\\\\\\"sceneUrl\\\\\\":\\\\\\"alipays:\\/\\/platformapi\\/startapp?appId=20000003&actionType=toBillDetails&tradeNO=20240318200040031100470038298342&bizType=B_TRANSFER\\\\\\",\\\\\\"sceneType\\\\\\":\\\\\\"nativeApp\\\\\\",\\\\\\"sceneName\\\\\\":\\\\\\"支付宝红包\\\\\\",\\\\\\"sceneIcon\\\\\\":\\\\\\"https:\\/\\/gw.alipayobjects.com\\/zos\\/mwalletmng\\/nZabLjEfmakCSxAcBhmP.png\\\\\\"},\\\\\\"assistMsg2\\\\\\":\\\\\\"支付宝红包\\\\\\",\\\\\\"assistMsg1\\\\\\":\\\\\\"农业银行储蓄卡(9979)\\\\\\",\\\\\\"assistName4\\\\\\":\\\\\\"\\\\\\",\\\\\\"assistMsg5\\\\\\":\\\\\\"\\\\\\",\\\\\\"assistMsg4\\\\\\":\\\\\\"\\\\\\",\\\\\\"assistName5\\\\\\":\\\\\\"\\\\\\",\\\\\\"buttonLink\\\\\\":\\\\\\"\\\\\\",\\\\\\"cardAdInfo\\\\\\":{\\\\\\"p14\\\\\\":{\\\\\\"bizMonitor\\\\\\":{\\\\\\"marketingUniqueId\\\\\\":\\\\\\"MUc1c9130feec24322809e8e07c75d1f57\\\\\\",\\\\\\"marketingRuleId\\\\\\":\\\\\\"MR64275da897224e1885d1983774ed4bf1\\\\\\",\\\\\\"style\\\\\\":\\\\\\"singleLineText3\\\\\\",\\\\\\"marketingItemId\\\\\\":\\\\\\"MI486b37289402428fb8a3597fd88ba1e4\\\\\\"},\\\\\\"expireTime\\\\\\":1742310326225,\\\\\\"marketingUniqueId\\\\\\":\\\\\\"MUc1c9130feec24322809e8e07c75d1f57\\\\\\",\\\\\\"minClientVersion\\\\\\":\\\\\\"10.1.98\\\\\\",\\\\\\"recommendTemplateId\\\\\\":\\\\\\"singleLineText3\\\\\\",\\\\\\"viewInfo\\\\\\":{\\\\\\"arrowIcon\\\\\\":\\\\\\"https:\\/\\/img.alicdn.com\\/tfs\\/TB1fN1OdggP7K4jSZFqXXamhVXa-32-52.png\\\\\\",\\\\\\"actionType\\\\\\":\\\\\\"link\\\\\\",\\\\\\"actionUrl\\\\\\":\\\\\\"alipays:\\/\\/platformapi\\/startapp?appId=2021001168603174&page=pages%2Findex%2Findex&chInfo=kfhbdz\\\\\\",\\\\\\"text\\\\\\":\\\\\\"进入红包小程序\\\\\\",\\\\\\"textColor\\\\\\":\\\\\\"#333333\\\\\\"}},\\\\\\"p116\\\\\\":{\\\\\\"bizMonitor\\\\\\":{\\\\\\"marketingUniqueId\\\\\\":\\\\\\"MUe24bc5c867e24dae93d64606a28926a2\\\\\\",\\\\\\"outBizId\\\\\\":\\\\\\"LIFE_MSG_TEXT|AMTT202301041491564916|202402261861183548\\\\\\",\\\\\\"marketingRuleId\\\\\\":\\\\\\"MR9b1daa035f8440668c2cd692768d3308\\\\\\",\\\\\\"style\\\\\\":\\\\\\"actionLine2\\\\\\",\\\\\\"marketingItemId\\\\\\":\\\\\\"MIe2bc161773614c6cb36a9dc4968a0908\\\\\\"},\\\\\\"expireTime\\\\\\":1742310326351,\\\\\\"marketingUniqueId\\\\\\":\\\\\\"MUe24bc5c867e24dae93d64606a28926a2\\\\\\",\\\\\\"minClientVersion\\\\\\":\\\\\\"10.1.98\\\\\\",\\\\\\"recommendTemplateId\\\\\\":\\\\\\"actionLine2\\\\\\",\\\\\\"viewInfo\\\\\\":{\\\\\\"btnName\\\\\\":\\\\\\"支付奖励\\\\\\",\\\\\\"actionType\\\\\\":\\\\\\"link\\\\\\",\\\\\\"tagIcon\\\\\\":\\\\\\"https:\\/\\/mdn.alipayobjects.com\\/huamei_cke3ep\\/afts\\/img\\/A*s1xhTYe-_PQAAAAAAAAAAAAADk1-AQ\\/original\\\\\\",\\\\\\"tagColor\\\\\\":\\\\\\"#FF6011\\\\\\",\\\\\\"actionUrl\\\\\\":\\\\\\"alipays:\\/\\/platformapi\\/startapp?appId=68687805&url=https%3A%2F%2Frender.alipay.com%2Fp%2Fyuyan%2F180020380000000023%2Fhome-page.html%3Fbid%3D202307312090875679%26source%3DLIFE_MSG_TEXT%26chInfo%3DLIFE_MSG_TEXT%26passInfo%3D%7B%22ttci%22%3A%22AMTT202301041491564916%22%2C%22ch%22%3A%22LIFE_MSG_TEXT%22%7D\\\\\\",\\\\\\"tag\\\\\\":\\\\\\"积分当钱花，兑水电煤红包\\\\\\"}}}}\\"}"}]`,
        dataType: DataType.App,
        app: "com.eg.android.AlipayGphone"
    }
    function print(result) {
        expect(result).toEqual(
            `{"type":0,"money":1,"fee":0,"shopName":"支付宝红包","shopItem":"","accountNameFrom":"农业银行储蓄卡(9979)","accountNameTo":"","currency":"CNY","time":1710774326000,"channel":"支付宝付款成功","ruleName":"支付宝消息盒子"}`
        )
    }
    eval(data)
});